@model ProfileModel
@{
    ViewData["Title"] = "Index";
}
@{ var userGreeting = Model.AppUser.Name is null ? Model.AppUser.UserName : Model.AppUser.Name; }
<div class="row">
    <div class="col-xs-12 col-sm-4 col-md-3">
        <h2>@userGreeting's profile</h2>
        @if (User.Identity.Name == Model.AppUser.UserName)
        {
            <a asp-area="Identity" asp-page="/Account/Manage/Index" title="Manage">Manage account</a><br />
            <a asp-action="UserResults" asp-controller="TestResults">Your test results</a>
        }
    </div>
    <div class="col-xs-12 col-sm-8 col-md-9">
        @if(Model.UserTests.Count != 0)
        { 
         <table class="table" id="userTests">
            <thead>
                <tr>
                    <th>
                        Name
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.UserTests.First().CreationDate)
                    </th>
                    <th>
                        Duration
                    </th>
                    <th>
                        Test rating
                    </th>
                    <th>
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.UserTests)
                {
                    <tr>
                        <td>
                            <a asp-action="Index" asp-controller="TestQuestions" asp-route-id="@item.Id">@Html.DisplayFor(modelItem => item.TestName)</a>
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CreationDate)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.TestDuration)
                        </td>
                        <td>
                            @{var rating = item.TestMarks.Count(tm => tm.EnjoyedTest) - item.TestMarks.Count(tm => !tm.EnjoyedTest); }
                            @if (rating > 0)
                            {
                                <span class="text-success">@rating</span>
                            }
                            else if (rating < 0)
                            {
                                <span class="text-danger">@rating</span>
                            }
                            else
                            {
                                <span>@rating</span>
                            }

                        </td>
                        <td>
                          <a asp-action="Index" asp-controller="TestEngine" asp-route-code="@item.TestCode">Try test out</a><span> |</span>
                          <a asp-action="Details" asp-route-id="@item.Id" asp-controller="Tests">Details</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        }else
        {
         <span>No tests yet(</span>
        }
    </div>
</div>
