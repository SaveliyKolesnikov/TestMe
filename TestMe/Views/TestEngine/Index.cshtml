@model TestMe.Models.Test
@{

}
<div class="container-fluid">
    <form asp-controller="TestEngine" asp-action="StartTest" id="startTestForm" method="post">
        @Html.AntiForgeryToken()
        <h1 class="text-center">@Model.TestName</h1>
        <h2>Author: @Model.AppUser.UserName</h2>
        <h3>Creation date: @Model.CreationDate</h3>
        <h4>Question amount: @Model.TestQuestions.Count</h4>
        <input type="hidden" value="@Model.TestCode" id="testCode" />
        <button type="button" class="btn btn-primary btn-lg center-block" id="startButton">Start test</button>
    </form>
    <form asp-controller="TestEngine" asp-action="StartTest" id="questionForm" method="post" display="none">
        @Html.AntiForgeryToken()
        <fieldset id="testQuestionFieldSet">
            <legend id="questionText"></legend>

            @*<div>
                <input type="checkbox" id="scales" name="feature"
                       value="scales" checked />
                <label for="scales">Scales</label>
            </div>

            <div>
                <input type="checkbox" id="horns" name="feature"
                       value="horns" />
                <label for="horns">Horns</label>
            </div>

            <div>
                <input type="checkbox" id="claws" name="feature"
                       value="claws" />
                <label for="claws">Claws</label>
            </div>*@

        </fieldset>

    </form>
</div>

@section Scripts{
    <script type="text/javascript">
        function startTest() {
            var token = $('input[name="__RequestVerificationToken"]', $('#startTestForm')).val();
            var myData = { code: $("#testCode").val() };
            var dataWithAntiforgeryToken = $.extend(myData, { '__RequestVerificationToken': token });

            $.ajax({
                url: "/TestEngine/StartTest",
                type: "POST",
                data: dataWithAntiforgeryToken,
                success: function (data) {
                    //data.TestAnswers.forEach(function (element) {
                    //    $("#questionForm").append("<div>" + element.AnswerText + "</div>");
                    //});
                    $("#questionForm").show();
                    $("#questionText").append("<h1>" + data.questionText + "</h1>");
                    $("#startTestForm").hide();
                    data.testAnswers.forEach(function (element) {
                        $("#testQuestionFieldSet").append("<div>" + element.answerText + "</div>");
                    });
                },
                error: function () {
                    $("#StorageLocations").empty();

                }
            });
        }

        $("#startButton").on("click", startTest);
    </script>
}

